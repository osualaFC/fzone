    name: Publish

    on:
      push:
        branches: [master]

    jobs:
      test-and-distribute:
        runs-on: ubuntu-latest
        steps:
          - uses: actions/checkout@v2
          - name: set up JDK 11
            uses: actions/setup-java@v1
            with:
              java-version: 11
          - name: Assemble Release Bundle
            run: |
              ./gradlew bundleRelease
          - name: Sign Release
            uses: r0adkll/sign-android-release@v1
            with:
              releaseDirectory: app/release
              signingKeyBase64: ${{ secrets.ANDROID_KEY_STORE }}
              alias: ${{ secrets.KEY_ALIAS }}
              keyStorePassword: ${{ secrets.KEY_STORE_PASSWORD }}
              keyPassword: ${{ secrets.KEY_PASSWORD }}

          - name: Create service_account.json
            run: echo '${{ secrets.PLAY_CONFIG_JSON }}' > service_account.json

          - name: Deploy to Internal
            uses: r0adkll/upload-google-play@v1
            with:
              serviceAccountJson: service_account.json
              packageName: com.fredosuala.fzone
              releaseFiles: app/bundle/outputs/bundle/release/app-release.aab
              track: internal
              whatsNewDirectory: whatsNewDirectory/